"""
üß† –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è —Å–∞–º–æ–æ–±—É—á–∞—é—â–µ–≥–æ—Å—è –∞–≥–µ–Ω—Ç–∞
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç CoolPrompt –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ª—É—á—à–µ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è GPT-5

–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:
1. –°–æ–∑–¥–∞–µ—Ç –±–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –∑–∞–¥–∞—á–∏ —Å–∞–º–æ–æ–±—É—á–µ–Ω–∏—è
2. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç CoolPrompt (–≥–µ–Ω–µ—Ç–∏—á–µ—Å–∫–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º) –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç –≤ —Ñ–∞–π–ª
4. –≠—Ç–æ—Ç –ø—Ä–æ–º–ø—Ç –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø–µ—Ä–µ–¥–µ–ª–∫–∏ test_agent3_air.py
"""
import os
import sys
import logging
from io import StringIO
from pathlib import Path
from datetime import datetime

# –ü–æ–¥–∞–≤–ª—è–µ–º NLTK –ª–æ–≥–∏
logging.getLogger('nltk').setLevel(logging.CRITICAL)

class SuppressNLTKDownload:
    def __enter__(self):
        self._original_stderr = sys.stderr
        sys.stderr = StringIO()
        return self
    
    def __exit__(self, *args):
        sys.stderr = self._original_stderr

# –ò–º–ø–æ—Ä—Ç NLTK –¥–∞–Ω–Ω—ã—Ö (—Ç–∏—Ö–æ)
import nltk
with SuppressNLTKDownload():
    try:
        nltk.download('wordnet', quiet=True)
        nltk.download('punkt_tab', quiet=True)
        nltk.download('omw-1.4', quiet=True)
    except:
        pass

from coolprompt.assistant import PromptTuner
from langchain_openai import ChatOpenAI

# API –∫–ª—é—á OpenAI
API_KEY = os.environ.get("OPENAI_API_KEY", "your-api-key-here")

def create_base_prompt():
    """–°–æ–∑–¥–∞–µ—Ç –±–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è —Å–∞–º–æ–æ–±—É—á–∞—é—â–µ–≥–æ—Å—è –∞–≥–µ–Ω—Ç–∞"""
    
    base_prompt = """
–ó–∞–¥–∞—á–∞: –î–æ–±–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É —Å–∞–º–æ–æ–±—É—á–µ–Ω–∏—è –≤ –∞–≥–µ–Ω—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ Airtable.

–ö–û–ù–¢–ï–ö–°–¢:
–£ –º–µ–Ω—è –µ—Å—Ç—å —Ä–∞–±–æ—á–∏–π —Å–∫—Ä–∏–ø—Ç test_agent3_air.py (~2600 —Å—Ç—Ä–æ–∫), –∫–æ—Ç–æ—Ä—ã–π:
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Gemini Computer Use API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±—Ä–∞—É–∑–µ—Ä–æ–º —á–µ—Ä–µ–∑ Playwright
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –∞–∫–∫–∞—É–Ω—Ç—ã –≤ Airtable
- –ü—Ä–æ—Ö–æ–¥–∏—Ç –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å: –ø–æ–ª—É—á–µ–Ω–∏–µ email ‚Üí —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ (10+ —à–∞–≥–æ–≤)
- –†–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ, –Ω–æ –∫–∞–∂–¥—ã–π —Ä–∞–∑ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏–π

–ü–†–û–ë–õ–ï–ú–ê:
–ê–≥–µ–Ω—Ç –Ω–µ —É—á–∏—Ç—Å—è –Ω–∞ –æ–ø—ã—Ç–µ. –û–Ω –Ω–µ –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç:
- –ö–∞–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –±—ã—Å—Ç—Ä–µ–µ
- –ö–∞–∫–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–µ
- –ö–∞–∫–∏–µ —Ç–∞–π–º–∞—É—Ç—ã –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã
- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø—É—Ç–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

–¶–ï–õ–¨:
–î–æ–±–∞–≤–∏—Ç—å —Å–∞–º–æ–æ–±—É—á–µ–Ω–∏–µ, —á—Ç–æ–±—ã –∞–≥–µ–Ω—Ç:
1. **–°–æ–±–∏—Ä–∞–ª –æ–ø—ã—Ç** –≤–æ –≤—Ä–µ–º—è –∫–∞–∂–¥–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (–º–µ—Ç—Ä–∏–∫–∏, —É—Å–ø–µ—à–Ω–æ—Å—Ç—å, –≤—Ä–µ–º—è)
2. **–°–æ—Ö—Ä–∞–Ω—è–ª –∑–Ω–∞–Ω–∏—è** –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏ (–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
3. **–ü—Ä–∏–º–µ–Ω—è–ª –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—É—Å–∫–∞—Ö (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –ª—É—á—à–∏–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏)
4. **–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–ª** –¥–ª—è –ø–æ–∏—Å–∫–∞ –µ—â–µ –±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã—Ö –ø—É—Ç–µ–π

–û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø:
- –ù–ï –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å –≤–µ—Å—å –∫–æ–¥ —Å –Ω—É–ª—è
- –ù–ï –ª–æ–º–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –ª–æ–≥–∏–∫—É Computer Use + Playwright
- –ù–ï –º–µ–Ω—è—Ç—å –≤–Ω–µ—à–Ω–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (—Ñ—É–Ω–∫—Ü–∏—è register_airtable_account –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Ä–∞–Ω—å—à–µ)
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ –∏–Ω–≤–∞–∑–∏–≤–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–°–í–û–ë–û–î–ê –†–ï–®–ï–ù–ò–Ø:
–¢—ã —Å–∞–º —Ä–µ—à–∞–µ—à—å:
- –ö–∞–∫—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å (–∫–ª–∞—Å—Å—ã, —Ñ—É–Ω–∫—Ü–∏–∏, –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –∏ —Ç.–¥.)
- –ö–∞–∫ —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ (JSON, SQLite, pickle –∏ —Ç.–¥.)
- –ö–∞–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ —Å–æ–±–∏—Ä–∞—Ç—å
- –ö–∞–∫ –≤—ã–±–∏—Ä–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
- –ö–∞–∫ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—é (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª—É—á—à–∏—Ö —Å—Ç—Ä–∞—Ç–µ–≥–∏–π) vs –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ (–ø–æ–∏—Å–∫ –Ω–æ–≤—ã—Ö)

–û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢:
–ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ - –∞–≥–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–±—ã—á–Ω–æ.
–ü–æ—Å–ª–µ 5-10 —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π - –∞–≥–µ–Ω—Ç —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ –∏ –Ω–∞–¥–µ–∂–Ω–µ–µ.
–ü–æ—Å–ª–µ 20+ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π - –∞–≥–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ, –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º.

–¢–≤–æ—è –∑–∞–¥–∞—á–∞: –ø—Ä–∏–¥—É–º–∞—Ç—å —ç–ª–µ–≥–∞–Ω—Ç–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –∏ –ø–æ–∫–∞–∑–∞—Ç—å –ö–ê–ö –µ–≥–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ test_agent3_air.py.
"""
    
    return base_prompt.strip()


def optimize_prompt_with_coolprompt(base_prompt: str, model_name: str = "gpt-5-chat-latest"):
    """
    –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç —Å –ø–æ–º–æ—â—å—é CoolPrompt
    
    Args:
        base_prompt: –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
        model_name: –ú–æ–¥–µ–ª—å GPT –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        
    Returns:
        –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç
    """
    print("=" * 80)
    print("üß† COOLPROMPT: –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ü–†–û–ú–ü–¢–ê –î–õ–Ø –°–ê–ú–û–û–ë–£–ß–ê–Æ–©–ï–ì–û–°–Ø –ê–ì–ï–ù–¢–ê")
    print("=" * 80)
    
    try:
        # –°–æ–∑–¥–∞–µ–º –º–æ–¥–µ–ª—å GPT-5
        llm = ChatOpenAI(
            model=model_name,
            temperature=0.7,
            api_key=API_KEY,
            timeout=120  # –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ç–∞–π–º–∞—É—Ç –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –∑–∞–¥–∞—á–∏
        )
        
        print(f"\n‚úÖ –ú–æ–¥–µ–ª—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞: {model_name}")
        print(f"üìù –î–ª–∏–Ω–∞ –±–∞–∑–æ–≤–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞: {len(base_prompt)} —Å–∏–º–≤–æ–ª–æ–≤")
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º PromptTuner
        prompt_tuner = PromptTuner(target_model=llm)
        
        print("\nüîÑ –ó–∞–ø—É—Å–∫ –≥–µ–Ω–µ—Ç–∏—á–µ—Å–∫–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–∞...")
        print("‚è≥ –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 2-5 –º–∏–Ω—É—Ç...")
        print("-" * 80)
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é
        prompt_tuner.run(base_prompt)
        
        print("\n" + "=" * 80)
        print("‚úÖ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê!")
        print("=" * 80)
        
        optimized_prompt = prompt_tuner.final_prompt
        
        print(f"\nüìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê:")
        print(f"   - –î–ª–∏–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞: {len(optimized_prompt)} —Å–∏–º–≤–æ–ª–æ–≤")
        print(f"   - –†–∞–∑–Ω–∏—Ü–∞: {len(optimized_prompt) - len(base_prompt):+d} —Å–∏–º–≤–æ–ª–æ–≤")
        
        return optimized_prompt
        
    except Exception as e:
        print(f"\n‚ùå –û–®–ò–ë–ö–ê –ø—Ä–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏: {e}")
        print(f"   –¢–∏–ø –æ—à–∏–±–∫–∏: {type(e).__name__}")
        import traceback
        traceback.print_exc()
        
        print("\n‚ö†Ô∏è  –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –ø—Ä–æ–º–ø—Ç (–±–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)")
        return base_prompt


def save_prompt_to_file(prompt: str, filename: str = None):
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–º–ø—Ç –≤ —Ñ–∞–π–ª —Å timestamp"""
    
    if filename is None:
        timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
        filename = f"optimized_prompt_self_learning_{timestamp}.txt"
    
    output_path = Path(__file__).parent / filename
    
    with open(output_path, 'w', encoding='utf-8') as f:
        f.write("=" * 80 + "\n")
        f.write("üß† –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ô –ü–†–û–ú–ü–¢ –î–õ–Ø –°–ê–ú–û–û–ë–£–ß–ê–Æ–©–ï–ì–û–°–Ø –ê–ì–ï–ù–¢–ê\n")
        f.write("=" * 80 + "\n")
        f.write(f"–°–æ–∑–¥–∞–Ω: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n")
        f.write(f"–ú–æ–¥–µ–ª—å: GPT-5\n")
        f.write(f"–ú–µ—Ç–æ–¥: CoolPrompt (–≥–µ–Ω–µ—Ç–∏—á–µ—Å–∫–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º)\n")
        f.write("=" * 80 + "\n\n")
        f.write(prompt)
        f.write("\n\n" + "=" * 80 + "\n")
        f.write("–ö–ê–ö –ò–°–ü–û–õ–¨–ó–û–í–ê–¢–¨:\n")
        f.write("=" * 80 + "\n")
        f.write("1. –°–∫–æ–ø–∏—Ä—É–π —ç—Ç–æ—Ç –ø—Ä–æ–º–ø—Ç —Ü–µ–ª–∏–∫–æ–º\n")
        f.write("2. –û—Ç–ø—Ä–∞–≤—å GPT-5 –≤–º–µ—Å—Ç–µ —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º test_agent3_air.py\n")
        f.write("3. GPT-5 –¥–æ–±–∞–≤–∏—Ç —Å–∏—Å—Ç–µ–º—É —Å–∞–º–æ–æ–±—É—á–µ–Ω–∏—è –≤ –∫–æ–¥\n")
        f.write("4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –Ω–æ–≤—ã–π –∫–æ–¥ –Ω–∞ 2-3 —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è—Ö\n")
        f.write("5. –°–∏—Å—Ç–µ–º–∞ –Ω–∞—á–Ω–µ—Ç —Å–æ–±–∏—Ä–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è\n")
        f.write("=" * 80 + "\n")
    
    print(f"\nüíæ –ü—Ä–æ–º–ø—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤: {output_path}")
    return output_path


def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    
    print("\n" + "=" * 80)
    print("üöÄ –ì–ï–ù–ï–†–ê–¢–û–† –ü–†–û–ú–ü–¢–ê –î–õ–Ø –°–ê–ú–û–û–ë–£–ß–ê–Æ–©–ï–ì–û–°–Ø –ê–ì–ï–ù–¢–ê")
    print("=" * 80)
    
    # –®–∞–≥ 1: –°–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç
    print("\nüìù –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞...")
    base_prompt = create_base_prompt()
    print(f"   ‚úÖ –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç —Å–æ–∑–¥–∞–Ω ({len(base_prompt)} —Å–∏–º–≤–æ–ª–æ–≤)")
    
    # –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ OpenAI –∫–ª—é—á–∞
    use_coolprompt = False
    if API_KEY and API_KEY != "your-api-key-here":
        print(f"\n‚úÖ OpenAI API –∫–ª—é—á –Ω–∞–π–¥–µ–Ω: {API_KEY[:8]}...{API_KEY[-4:]}")
        print("üß¨ –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ CoolPrompt")
        use_coolprompt = True
    else:
        print("\n‚ö†Ô∏è  OpenAI API –∫–ª—é—á –Ω–µ –Ω–∞–π–¥–µ–Ω")
        print("   –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –±–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç (–±–µ–∑ CoolPrompt –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)")
        print("   –ë–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç —É–∂–µ —Ö–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!")
    
    # –®–∞–≥ 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å –∫–ª—é—á)
    if use_coolprompt:
        print("\nüß¨ –®–∞–≥ 2: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å CoolPrompt...")
        print("‚è≥ –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 2-5 –º–∏–Ω—É—Ç...")
        final_prompt = optimize_prompt_with_coolprompt(base_prompt)
    else:
        print("\n‚úÖ –®–∞–≥ 2: –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç")
        final_prompt = base_prompt
    
    # –®–∞–≥ 4: –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    print("\nüíæ –®–∞–≥ 3: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞...")
    output_file = save_prompt_to_file(final_prompt)
    
    # –§–∏–Ω–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥
    print("\n" + "=" * 80)
    print("‚úÖ –ì–û–¢–û–í–û!")
    print("=" * 80)
    print(f"\nüìÑ –ü—Ä–æ–º–ø—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤:")
    print(f"   {output_file}")
    print("\nüìã –ß–¢–û –î–ï–õ–ê–¢–¨ –î–ê–õ–¨–®–ï:")
    print("   1. –û—Ç–∫—Ä–æ–π —Ñ–∞–π–ª —Å –ø—Ä–æ–º–ø—Ç–æ–º")
    print("   2. –°–∫–æ–ø–∏—Ä—É–π —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ")
    print("   3. –û—Ç–ø—Ä–∞–≤—å GPT-5 Pro –≤–º–µ—Å—Ç–µ —Å test_agent3_air.py")
    print("   4. GPT-5 –ø—Ä–∏–¥—É–º–∞–µ—Ç –∏ –¥–æ–±–∞–≤–∏—Ç —Å–∏—Å—Ç–µ–º—É —Å–∞–º–æ–æ–±—É—á–µ–Ω–∏—è")
    print("   5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è—Ö")
    print("\n" + "=" * 80)
    
    # –í—ã–≤–æ–¥–∏–º –ø—Ä–µ–≤—å—é –ø—Ä–æ–º–ø—Ç–∞
    print("\nüìÑ –ü–†–ï–í–¨–Æ –ü–†–û–ú–ü–¢–ê:")
    print("-" * 80)
    preview_lines = final_prompt.split('\n')[:30]
    print('\n'.join(preview_lines))
    if len(final_prompt.split('\n')) > 30:
        print("\n... (–æ—Å—Ç–∞–ª—å–Ω–æ–µ –≤ —Ñ–∞–π–ª–µ) ...")
    print("-" * 80)


if __name__ == "__main__":
    main()
