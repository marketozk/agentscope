# Инструкции для GitHub Copilot

## ⚠️ КРИТИЧЕСКИ ВАЖНО: Текущий активный терминал

**ПЕРЕД КАЖДОЙ КОМАНДОЙ**:
1. Проверь Terminal Context в сообщении пользователя
2. Определи РЕАЛЬНЫЙ тип терминала (PowerShell/CMD/Bash)
3. Адаптируй синтаксис под ЭТОТ терминал

**НЕ предполагай** тип терминала - ВСЕГДА проверяй контекст!

---

## Работа с терминалами в Windows

### ⚠️ КРИТИЧЕСКИ ВАЖНО: Определение типа терминала

Перед выполнением ЛЮБОЙ команды в терминале необходимо:

1. **Определить активный терминал** из контекста
2. **Подстроить синтаксис команды** под тип терминала
3. **Учитывать особенности каждого терминала**

### Типы терминалов и их особенности

#### 1. PowerShell (по умолчанию в VS Code)
```powershell
# ✓ Правильно для PowerShell:
cd "c:\Users\regis\OneDrive\Рабочий стол\Проект AgentScope"
python test.py

# ✗ НЕПРАВИЛЬНО - не работает &&
cd path && python test.py  # ОШИБКА!

# ✓ Правильно - использовать ; для последовательных команд
cd path; python test.py

# ✓ Правильно - использовать отдельные команды
cd path
python test.py
```

**Особенности PowerShell:**
- ❌ НЕ поддерживает `&&` для объединения команд
- ✅ Использовать `;` для последовательного выполнения
- ✅ Кавычки обязательны для путей с пробелами
- ✅ Пути могут содержать кириллицу
- ⚠️ Дефис в именах может восприниматься как параметр (например, `browser-use` вызовет ошибку)

#### 2. CMD (Command Prompt)
```cmd
REM ✓ Правильно для CMD:
cd /d "c:\Users\regis\OneDrive\Рабочий стол\Проект AgentScope"
python test.py

REM ✓ CMD поддерживает &&
cd /d "path" && python test.py

REM ✓ Можно использовать cmd /c для выполнения
cmd /c "cd /d path && python test.py"
```

**Особенности CMD:**
- ✅ Поддерживает `&&` для объединения команд
- ✅ Использовать `cd /d` для смены диска и папки
- ✅ Кавычки обязательны для путей с пробелами
- ✅ Более стабилен для путей с кириллицей

#### 3. Git Bash (если установлен)
```bash
# ✓ Правильно для Git Bash (Unix-стиль):
cd "/c/Users/regis/OneDrive/Рабочий стол/Проект AgentScope"
python test.py

# ✓ Поддерживает &&
cd path && python test.py
```

**Особенности Git Bash:**
- ✅ Unix-стиль путей: `/c/` вместо `C:\`
- ✅ Поддерживает `&&`, `||`, `;`
- ⚠️ Может быть проблема с путями на кириллице

### Алгоритм выполнения команд в терминале

```
1. Получить контекст терминала
   ├─ Проверить Terminal Context в контексте сообщения
   ├─ Определить тип: PowerShell / CMD / Git Bash
   └─ Узнать текущую рабочую директорию (Cwd)

2. Проверить путь выполнения
   ├─ Есть ли пробелы в пути? → Обернуть в кавычки
   ├─ Есть ли кириллица? → Предпочесть CMD или абсолютные пути
   └─ Нужна ли смена директории? → Использовать правильный синтаксис

3. Адаптировать команду под терминал
   ├─ PowerShell:
   │  ├─ Использовать ; вместо &&
   │  ├─ Разбивать на отдельные команды
   │  └─ Избегать дефисов в начале слов
   ├─ CMD:
   │  ├─ Использовать cmd /c "команды" для безопасности
   │  ├─ Можно использовать &&
   │  └─ Использовать cd /d для смены диска
   └─ Git Bash:
      ├─ Использовать Unix-пути (/c/ вместо C:\)
      └─ Стандартный bash-синтаксис

4. Выполнить команду
   └─ Использовать run_in_terminal с правильным синтаксисом
```

### Примеры правильного выполнения

#### Пример 1: Запуск Python скрипта

```python
# Анализ контекста:
# Terminal: PowerShell
# Cwd: C:\Users\regis\OneDrive\Рабочий стол\Проект AgentScope

# ✓ ПРАВИЛЬНО:
run_in_terminal(
    command='..\.venv\Scripts\python.exe Browser_Use\test_working_models.py',
    explanation='Запуск теста моделей',
    isBackground=False
)

# ✗ НЕПРАВИЛЬНО:
run_in_terminal(
    command='cd Browser_Use && python test_working_models.py',  # && не работает в PowerShell!
    ...
)
```

#### Пример 2: Смена директории и выполнение команды

```python
# Анализ контекста:
# Terminal: PowerShell
# Нужно: сменить папку и запустить скрипт

# ✓ ПРАВИЛЬНО - Вариант 1 (отдельные команды):
run_in_terminal(
    command='cd Browser_Use',
    explanation='Переход в папку Browser_Use',
    isBackground=False
)
# Затем:
run_in_terminal(
    command='..\.venv\Scripts\python.exe test_working_models.py',
    explanation='Запуск теста',
    isBackground=False
)

# ✓ ПРАВИЛЬНО - Вариант 2 (через cmd /c):
run_in_terminal(
    command='cmd /c "cd /d Browser_Use && ..\.venv\Scripts\python.exe test_working_models.py"',
    explanation='Запуск теста через CMD',
    isBackground=False
)

# ✓ ПРАВИЛЬНО - Вариант 3 (абсолютный путь):
run_in_terminal(
    command='..\.venv\Scripts\python.exe "Browser_Use\test_working_models.py"',
    explanation='Запуск теста с абсолютным путем',
    isBackground=False
)
```

#### Пример 3: Git команды

```python
# Анализ контекста:
# Terminal: PowerShell
# Git команды обычно работают нормально

# ✓ ПРАВИЛЬНО:
run_in_terminal(
    command='git status',
    explanation='Проверка статуса Git',
    isBackground=False
)

run_in_terminal(
    command='git add Browser_Use/',
    explanation='Добавление файлов в staging',
    isBackground=False
)

run_in_terminal(
    command='git commit -m "feat: Add new feature"',
    explanation='Коммит изменений',
    isBackground=False
)
```

### Распространенные ошибки и их решения

| Ошибка | Причина | Решение |
|--------|---------|---------|
| `Лексема "&&" не является допустимым разделителем` | Использование `&&` в PowerShell | Использовать `;` или `cmd /c` |
| `Имя "xxx" не распознано как имя командлета` | Дефис или пробел в имени | Обернуть в кавычки или использовать CMD |
| `ObjectNotFound` для пути с пробелами | Путь не в кавычках | Добавить кавычки вокруг пути |
| `CommandNotFoundException` для команды с кириллицей | PowerShell проблема с кодировкой | Использовать `cmd /c` обертку |

### Чек-лист перед выполнением команды

- [ ] Определил тип активного терминала
- [ ] Проверил текущую рабочую директорию
- [ ] Адаптировал синтаксис команды под терминал
- [ ] Обернул пути с пробелами в кавычки
- [ ] Использовал правильный разделитель команд (`;` для PowerShell, `&&` для CMD)
- [ ] Учел особенности путей с кириллицей
- [ ] Проверил наличие виртуального окружения (.venv)

### Рекомендации

1. **Предпочитать CMD для сложных команд** - он более предсказуем с путями на кириллице
2. **Использовать абсолютные пути** - меньше проблем со сменой директории
3. **Разбивать сложные команды** - лучше две простые команды, чем одна сложная с ошибкой
4. **Тестировать пути** - если путь содержит пробелы/кириллицу, обязательно использовать кавычки
5. **Логировать тип терминала** - всегда проверять Terminal Context перед выполнением

---

## Работа с Python окружением

### Активация виртуального окружения

```powershell
# PowerShell:
.venv\Scripts\Activate.ps1

# CMD:
.venv\Scripts\activate.bat
```

### Запуск Python скриптов

```powershell
# ✓ Правильно - использовать python.exe из venv:
.venv\Scripts\python.exe script.py

# ✗ Избегать глобального python:
python script.py  # Может использовать не тот интерпретатор
```

---

**Помни:** Большинство ошибок с терминалом возникает из-за неправильного определения типа терминала и использования несовместимого синтаксиса. Всегда анализируй контекст перед выполнением команды!
