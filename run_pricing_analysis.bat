@echo off
chcp 65001 > nul
echo ================================================================================
echo –ê–ù–ê–õ–ò–ó –ü–†–û–ë–õ–ï–ú–´ –° –¶–ï–ù–û–û–ë–†–ê–ó–û–í–ê–ù–ò–ï–ú –í –°–ò–°–¢–ï–ú–ï –°–ù–ê–ô–ü–ò–ù–ì–ê –¢–ï–ù–î–ï–†–û–í
echo ================================================================================
echo.

REM –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è OPENAI_API_KEY
if "%OPENAI_API_KEY%"=="" (
    echo ‚ùå –û–®–ò–ë–ö–ê: –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è OPENAI_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!
    echo.
    echo –î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ API –∫–ª—é—á–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
    echo    set OPENAI_API_KEY=sk-–≤–∞—à-–∫–ª—é—á-–∑–¥–µ—Å—å
    echo.
    echo –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –µ–≥–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —á–µ—Ä–µ–∑:
    echo    setx OPENAI_API_KEY "sk-–≤–∞—à-–∫–ª—é—á-–∑–¥–µ—Å—å"
    echo.
    pause
    exit /b 1
)

echo ‚úÖ API –∫–ª—é—á –Ω–∞–π–¥–µ–Ω
echo.

REM –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd /d "%~dp0"

echo üìÇ –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: %CD%
echo.

REM –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
if not exist ".venv\Scripts\python.exe" (
    echo ‚ùå –û–®–ò–ë–ö–ê: –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ .venv –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!
    echo.
    echo –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
    echo    python -m venv .venv
    echo    .venv\Scripts\pip.exe install -r requirements.txt
    echo.
    pause
    exit /b 2
)

echo ‚úÖ –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ
echo.

REM –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø—Ä–æ–º–ø—Ç-—Ñ–∞–π–ª–∞
if not exist "price_analysis_prompt.txt" (
    echo ‚ùå –û–®–ò–ë–ö–ê: –§–∞–π–ª price_analysis_prompt.txt –Ω–µ –Ω–∞–π–¥–µ–Ω!
    echo.
    pause
    exit /b 3
)

echo ‚úÖ –ü—Ä–æ–º–ø—Ç-—Ñ–∞–π–ª –Ω–∞–π–¥–µ–Ω
echo.

REM –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Å–∫—Ä–∏–ø—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞
if not exist "analyze_pricing_issue.py" (
    echo ‚ùå –û–®–ò–ë–ö–ê: –°–∫—Ä–∏–ø—Ç analyze_pricing_issue.py –Ω–µ –Ω–∞–π–¥–µ–Ω!
    echo.
    pause
    exit /b 4
)

echo ‚úÖ –°–∫—Ä–∏–ø—Ç –∞–Ω–∞–ª–∏–∑–∞ –Ω–∞–π–¥–µ–Ω
echo.

echo ================================================================================
echo –ó–ê–ü–£–°–ö –ê–ù–ê–õ–ò–ó–ê...
echo ================================================================================
echo.

REM –ó–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞
".venv\Scripts\python.exe" analyze_pricing_issue.py

if %ERRORLEVEL% neq 0 (
    echo.
    echo ‚ùå –ê–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π (–∫–æ–¥: %ERRORLEVEL%)
    pause
    exit /b %ERRORLEVEL%
)

echo.
echo ================================================================================
echo ‚úÖ –ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–ï–ù –£–°–ü–ï–®–ù–û!
echo ================================================================================
echo.
echo –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –ø–∞–ø–∫–µ logs\
echo –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª pricing_analysis_result_*.txt –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.
echo.
pause
